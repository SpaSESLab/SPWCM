#Load necessary packages
#Install packages if needed 
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("tidyverse")
#install.packages("googledrive")
#install.packages("googlesheets4")
library(dplyr)
library(ggplot2)
library(tidyverse)
library(googledrive)
library(googlesheets4)
options(
  gargle_oauth_cache = ".secrets",
  gargle_oauth_email = TRUE
  )

#Authenticate with Google Drive and Google Sheets
drive_auth()
gs4_auth()

#Load New Article Coding Framework Data Set
# Specify the folder name and file name
folder_name <- "VIP Fall2023"
file_name <- "New Article Coding Framework"

# Find the folder
folder <- drive_find(type = "folder", pattern = folder_name)

# Check if the folder is found
if (nrow(folder) == 0) {
  stop("Folder not found")
}

# Find the file within the folder
file <- drive_ls(path = as_id(folder$id), pattern = file_name)

# Check if the file is found
if (nrow(file) == 0) {
  stop("File not found in the specified folder")
}

# Read the data from the Google Sheets file
data <- read_sheet(file$id)

# Combine "Grizzly Bear" and "Grizzly Bears" variables
data <- data %>%
  mutate(Species = recode(Species, 
                          "Grizzly Bear" = "Grizzly Bears"))

# View the first few rows of the dataset, to make sure it worked
head(data)

#Remove duplicate entries of articles per species
unique_data <- data[!duplicated(data[c("Species", "Title")]), ]

#Create histogram of unique articles per species
plot <- ggplot(species_count, aes(x = Species, y = article_count, fill = Species)) +
  geom_bar(stat = "identity") +
  labs(title = "Number of Unique Articles per Species",
       x = "Species",
       y = "Number of Unique Articles") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")
plot

#Save the plot as an image file
ggsave(filename = "species_count_histogram.png", plot = plot,
       width = 10, height = 6, dpi = 300)
